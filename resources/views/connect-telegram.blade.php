@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4>Connect Your Telegram Account</h4>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <svg width="80" height="80" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto">
                            <rect width="40" height="40" rx="10" fill="#292521"></rect>
                            <path
                                d="M31.7059 9.54155C31.2525 9.07192 30.6334 8.79826 29.9809 8.77905C29.6458 8.7797 29.3142 8.84771 29.0059 8.97905L8.2559 17.9666C8.01118 18.0662 7.80434 18.2409 7.6651 18.4655C7.52586 18.6901 7.46137 18.953 7.4809 19.2166V20.0291C7.46748 20.3032 7.54467 20.5741 7.70055 20.8001C7.85643 21.026 8.08234 21.1943 8.3434 21.2791L13.7309 23.0791L15.3559 28.5666C15.4651 28.9512 15.676 29.2994 15.9664 29.5743C16.2567 29.8493 16.6158 30.0409 17.0059 30.1291C17.1553 30.1475 17.3065 30.1475 17.4559 30.1291C18.0103 30.1271 18.5428 29.9123 18.9434 29.5291L20.9309 27.6541L24.7809 30.6916C25.1505 30.9801 25.5938 31.1589 26.0602 31.2076C26.5266 31.2562 26.9972 31.1727 27.4184 30.9666L27.8309 30.7541C28.1837 30.5727 28.49 30.3127 28.7262 29.994C28.9625 29.6754 29.1223 29.3068 29.1934 28.9166L32.4809 11.9166C32.5581 11.4875 32.5277 11.0459 32.3924 10.6315C32.2572 10.217 32.0213 9.84254 31.7059 9.54155ZM27.3559 28.6166C27.3355 28.7245 27.2913 28.8266 27.2264 28.9152C27.1615 29.0039 27.0776 29.077 26.9809 29.1291L26.5684 29.3416C26.4871 29.3829 26.3971 29.4043 26.3059 29.4041C26.1728 29.4016 26.0447 29.353 25.9434 29.2666L21.2434 25.5166C21.1314 25.4173 20.9868 25.3624 20.8371 25.3624C20.6874 25.3624 20.5429 25.4173 20.4309 25.5166L17.6559 28.1291C17.6049 28.1665 17.5441 28.1882 17.4809 28.1916V23.7791C17.4811 23.6924 17.4989 23.6067 17.5333 23.5272C17.5676 23.4477 17.6179 23.376 17.6809 23.3166C21.6684 19.5666 24.0559 17.4666 25.4809 16.2666C25.5262 16.2251 25.5629 16.175 25.5886 16.1192C25.6144 16.0634 25.6287 16.003 25.6309 15.9416C25.6359 15.8815 25.6273 15.821 25.6056 15.7647C25.584 15.7085 25.5499 15.6578 25.5059 15.6166C25.445 15.54 25.3601 15.4861 25.265 15.4635C25.1698 15.4408 25.0698 15.4507 24.9809 15.4916L15.5309 21.4541C15.4469 21.494 15.3551 21.5148 15.2621 21.5148C15.1692 21.5148 15.0773 21.494 14.9934 21.4541L9.3559 19.5291L29.6934 10.7041C29.7674 10.6865 29.8444 10.6865 29.9184 10.7041C30.0089 10.7064 30.0979 10.7277 30.1797 10.7664C30.2614 10.8051 30.3343 10.8605 30.3934 10.9291C30.4787 11.0197 30.5413 11.1293 30.5761 11.2488C30.6108 11.3683 30.6168 11.4943 30.5934 11.6166L27.3559 28.6166Z"
                                fill="#FFF1E3"></path>
                        </svg>
                    </div>
                    
                    <h5 class="mb-3">To access tasks, please connect with our Telegram bot first</h5>
                    <p class="text-muted mb-4">
                        Our system needs to recognize you through Telegram. Please start a conversation with our bot,
                        then you'll be able to access your personalized tasks and earn points.
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <a href="https://t.me/baku_news_bot" target="_blank" class="btn btn-primary btn-lg w-100">
                                <svg width="20" height="20" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2">
                                    <rect width="40" height="40" rx="10" fill="#292521"></rect>
                                    <path
                                        d="M31.7059 9.54155C31.2525 9.07192 30.6334 8.79826 29.9809 8.77905C29.6458 8.7797 29.3142 8.84771 29.0059 8.97905L8.2559 17.9666C8.01118 18.0662 7.80434 18.2409 7.6651 18.4655C7.52586 18.6901 7.46137 18.953 7.4809 19.2166V20.0291C7.46748 20.3032 7.54467 20.5741 7.70055 20.8001C7.85643 21.026 8.08234 21.1943 8.3434 21.2791L13.7309 23.0791L15.3559 28.5666C15.4651 28.9512 15.676 29.2994 15.9664 29.5743C16.2567 29.8493 16.6158 30.0409 17.0059 30.1291C17.1553 30.1475 17.3065 30.1475 17.4559 30.1291C18.0103 30.1271 18.5428 29.9123 18.9434 29.5291L20.9309 27.6541L24.7809 30.6916C25.1505 30.9801 25.5938 31.1589 26.0602 31.2076C26.5266 31.2562 26.9972 31.1727 27.4184 30.9666L27.8309 30.7541C28.1837 30.5727 28.49 30.3127 28.7262 29.994C28.9625 29.6754 29.1223 29.3068 29.1934 28.9166L32.4809 11.9166C32.5581 11.4875 32.5577 11.0459 32.3924 10.6315C32.2572 10.217 32.0213 9.84254 31.7059 9.54155ZM27.3559 28.6166C27.3355 28.7245 27.2913 28.8266 27.2264 28.9152C27.1615 29.0039 27.0776 29.077 26.9809 29.1291L26.5684 29.3416C26.4871 29.3829 26.3971 29.4043 26.3059 29.4041C26.1728 29.4016 26.0447 29.353 25.9434 29.2666L21.2434 25.5166C21.1314 25.4173 20.9868 25.3624 20.8371 25.3624C20.6874 25.3624 20.5429 25.4173 20.4309 25.5166L17.6559 28.1291C17.6049 28.1665 17.5441 28.1882 17.4809 28.1916V23.7791C17.4811 23.6924 17.4989 23.6067 17.5333 23.5272C17.5676 23.4477 17.6179 23.376 17.6809 23.3166C21.6684 19.5666 24.0559 17.4666 25.4809 16.2666C25.5262 16.2251 25.5629 16.175 25.5886 16.1192C25.6144 16.0634 25.6287 16.003 25.6309 15.9416C25.6359 15.8815 25.6273 15.821 25.6056 15.7647C25.584 15.7085 25.5499 15.6578 25.5059 15.6166C25.445 15.54 25.3601 15.4861 25.265 15.4635C25.1698 15.4408 25.0698 15.4507 24.9809 15.4916L15.5309 21.4541C15.4469 21.494 15.3551 21.5148 15.2621 21.5148C15.1692 21.5148 15.0773 21.494 14.9934 21.4541L9.3559 19.5291L29.6934 10.7041C29.7674 10.6865 29.8444 10.6865 29.9184 10.7041C30.0089 10.7064 30.0979 10.7277 30.1797 10.7664C30.2614 10.8051 30.3343 10.8605 30.3934 10.9291C30.4787 11.0197 30.5413 11.1293 30.5761 11.2488C30.6108 11.3683 30.6168 11.4943 30.5934 11.6166L27.3559 28.6166Z"
                                        fill="white"></path>
                                </svg>
                                Start Chat with Bot
                            </a>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-outline-secondary btn-lg w-100" onclick="checkTelegramAuth()">
                                Already Connected? Verify
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <small class="text-muted">
                            After starting a chat with the bot, refresh this page to access your tasks.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function checkTelegramAuth() {
        // 发起一个AJAX请求来检查用户是否已通过Telegram认证
        fetch('/tasks/verify-auth', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.authenticated) {
                // 如果已认证，重定向到任务页面
                window.location.href = '/tasks';
            } else {
                // 如果未认证，显示提示信息
                alert('Please connect with Telegram bot first. Start a conversation with @baku_news_bot.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Please connect with Telegram bot first. Start a conversation with @baku_news_bot.');
        });
    }
</script>
@endsection